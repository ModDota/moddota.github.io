---
title: Typescript введение
author: Shush (перевод dEN5-tech)
steamId: 76561197994333648
date: 06.12.2021
---

Typescript - это мощный инструмент, который мы можем использовать для улучшения нашей способности правильно писать файлы для Dota 2. Используя tstl (Typescript-to-Lua), он автоматически генерирует Lua-файл для игры, чтобы использовать его для каждого файла, над которым вы работаете - этот процесс полностью автоматический с момента запуска.

Typescript более строг по сравнению с Lua, использует типы для обеспечения определенных функциональных возможностей и немедленно предупредит вас, если вы сделаете что-то, что не имеет смысла, и покажет ошибку, пока вы ее не исправите. Например, выполнение `GetStrength()` для способности не имеет смысла и приведет к сообщению об ошибке.
Однако Typescript может хорошо работать с большинством редакторов, использующих плагины,[VSCode](https://code.visualstudio.com/) рекомендуется, поскольку он имеет встроенную поддержку Typescript и является очень мощным редактором.

<StaticVideo path="videos/ts_example.mp4" controls="true" />

### Плюсы и минусы использования Typescript

**Плюсы:**
* Обеспечивает соблюдение типов, предотвращает использование неактуальных функций.
* Typescript гораздо больше похож на большинство языков, таких как C#, Java, Javascript и C (по сравнению с Lua).
* Автозаполнение, которое будет показывать только те функции API, которые соответствуют вызываемому типу.
* Экономит кучу времени, сразу находя логические ошибки в коде, вместо того, чтобы искать их в игре (иногда как крайние случаи, которые могут быть не обнаружены при локальном тестировании).
* Огромная поддержка Typescript в вебе (например. Stack Overflow) для ответов на общие вопросы по Typescript.
* Typescript сам по себе поставляется с очень мощными встроенными функциями и типами, такими как Sets, Maps и функции массивов. Кроме того, он поддерживает наследование классов и типов.
* Typescript используется как для Lua, так и для Javascript, поэтому вам никогда не придется переключаться между языками сценариев; Typescript преобразует его в нужный язык для вас.
* Автозаполнение различных аргументов в API, например, встроенного списка событий.
* Встроенные перечисления и интерфейсы, позволяющие быстро и легко найти конкретное значение, основанное на Dota.
* Очень легко обновлять новые API, когда Valve (со временем) выпускает новые функции.
* Симлинки папки Dota 2 для вас как часть установки, чтобы вы могли легко интегрировать свои изменения в github, если вы решите это сделать.

**минусы:**
* Требуется некоторое время для первой настройки.
* Некоторые редкие типы могут быть неправильными. Их можно обновить вручную, когда возникнет необходимость.
* Иногда требуется больше настроек для специфической игровой логики, таких как интерфейсы, защита типов и касты (это опять же связано с природой типизированного языка).
* Не очень удобно интегрировать для текущих проектов, хотя это все равно может работать.
* Ссылаться на код или руководства, написанные на Lua, может быть нелегко в Typescript из-за различий в работе этих языков.

### Настройка TypeScript

:::примечание
В данном руководстве предполагается, что ваша операционная система - Windows. Если у вас другие операционные системы, пожалуйста, свяжитесь с нами в канале Typescript в [Discord](#dedicated-typescript-channel-in-moddota-discord) below.
:::

Во-первых, поскольку Typescript использует Node.js, он должен быть установлен на вашем компьютере. Вы можете загрузить NodeJS  [здесь](https://nodejs.org/en/). Просто выберите рекомендуемую версию, которая является последней стабильной версией. Загрузите и установите его с конфигурацией по умолчанию.

Далее перейдите к [Типовой шаблон](https://github.com/ModDota/TypeScriptAddonTemplate). В этом шаблоне для вас настроено большинство файлов нового аддона, а также поддержка Typescript.
Существует два варианта использования шаблона:

1. Без GitHub: если вы не планируете размещать свой код на github, клонируйте приведенный выше шаблон. Как это сделать, смотрите ниже.

2. С помощью GitHub: если вы планируете разместить свой код на github, нажмите на кнопку ![Use this template](/images/typescript-tutorial/templateButton.png) кнопку, расположенную в правом верхнем углу страницы github. Это создаст новый репозиторий github, использующий шаблон под вашим именем. Заполните имя хранилища, описание, и является ли она государственной или частной. Вы можете оставить "Включить все ветви". снимите флажок, затем нажмите "Создать хранилище из шаблона". Когда новый репозиторий будет создан, клонируйте его. Как это сделать, смотрите ниже. Для тех, кто не знаком с github, я рекомендую использовать графический интерфейс Github, такой как [Github Desktop](https://desktop.github.com/).

Клонирование хранилища означает создание его копии на вашем компьютере. Это можно сделать, нажав на "Code", затем нажмите "Download Zip", как показано здесь:

![Cloning from Github](/images/typescript-tutorial/cloneRepo.png)

Затем вы можете извлечь ZIP в любое удобное для вас место. Однако НЕ помещайте его в папку Dota 2. Например, я поместил его на Рабочий стол, в папку с названием "Dota 2 custom games". Папка, которая будет извлечена, называется `TypeScriptAddonTemplate-master`, поэтому просто переименуйте папку, чтобы она более правильно отражала название вашей пользовательской игры. Для данного руководства я назвал его `typescript-example`.

### Создание аддона на основе Typescript в Dota

Теперь, когда у нас есть файлы на компьютере, мы можем очень быстро установить новый аддон к игре. Перед этим остается сделать несколько шагов:
* Зайдите в свою папку, в моем случае `typescript-example`.
* Откройте `package.json` любым текстовым редактором. Вы заметите, что поле `name` является пустой строкой. Добавьте название вашей пользовательской игры. Например, я назвал его `typescript_tutorial`. Поле должно выглядеть следующим образом:

```
"name": "typescript_tutorial",
```

Сохраните и закройте файл.

:::примечание
Убедитесь, что внутри папок `game/dota_addons` и `content/dota_addons` вашей папки с игрой Dota 2 нет папки с таким именем. Процесс установки создаст эти папки для вас. Если папки существуют, сначала удалите их или измените имя в файле `package.json` на другое.
:::

* Находясь в папке с файлом `package.json`, который вы только что отредактировали, нажмите на адресную строку, чтобы путь к вашей папке стал выделенным и редактируемым как текст. Это должно выглядеть следующим образом:

![Click on path](/images/typescript-tutorial/clickAddressBar.png)

* Пока путь выделен, удалите текст и вместо него введите "cmd". и нажмите Enter. В результате откроется командная оболочка, в которой путь к папке будет показан прямо перед курсором ввода.

* Введите `npm install` и нажмите клавишу Enter. Вы увидите полосу загрузки, которая займет не более минуты. Если все прошло успешно, вы должны увидеть, что ваши папки `game` и `content` теперь имеют "ярлык" значок рядом с ними. Теперь они связаны симлинками с вашей папкой Dota 2. Папка `typescript_tutorial` теперь существует для `game/dota_addons/` и `content/dota_addons` в вашей папке Dota 2.
:::note
Симлинкованные папки - это копии друг друга, где любое действие, выполненное над одной папкой, применяется и к другой. Поэтому вы можете просто работать в удобно расположенной папке (`Desktop/Dota 2 custom games/typescript-example` в моем примере), и он автоматически будет применен и к папке Steam Dota 2.
:::

### Структура аддона Typescript
Большая часть структуры Typescript идентична стандартному аддону Dota, например, наличие папки `scripts/npc/`.

Обратите внимание на папку `src` в корне проекта. Здесь вы создаете и работаете над файлами Typescript. Когда они компилируются, результирующие Lua-файлы помещаются в соответствующие места, например, `/game/scripts/vscripts/` для файлов, созданных из `/src/vscripts/`. Вы можете добавить дополнительные папки внутри этих папок, которые сохранят ту же маршрутизацию в месте вывода.

Вы можете изменить структуру папок внутри аддона. Однако вам может потребоваться настроить выходные пути в соответствии с этими изменениями. Некоторые изменения могут сломать мод, так как Dota ожидает, что будет установлена определенная структура (например, `game/scripts/vscripts`).
:::примечание
В `src` вы также найдете папку `common`. Эта папка чрезвычайно полезна для хранения интерфейсных деклараций, которые совместно используются игровой логикой и панорамой, таких как события и nettables, а также других пользовательских деклараций, таких как перечисления. **Эта папка должна содержать только файлы d.ts**.
:::


Есть несколько дополнительных файлов и папок, отвечающих за то, чтобы Typescript определял и работал с API Dota 2 и в пользовательской игре в целом.
Большинство этих файлов можно не трогать. Большинство этих файлов находится в папке `/src/vscripts/`:
* `tsconfig.json`: Настраивает работу Typescript в Lua-части проекта. Такой же тип файла существует в папке `/src/panorama/` для конфигурации javascript для панорамы.

* `vscripts/lib/dota_ts_adapter.ts`: Отвечает за регистрацию различных общих классов, таких как способности, предметы и модификаторы.
* `vscripts/lib/tstl-utils.ts`: Отвечает за перевод текста с typecript на Lua.
* `vscripts/lib/timers.Lua` и `vscripts/lib/timers.d.ts`: Общая библиотека Timers уже включена по умолчанию в ее Lua-форме, а файл timers.d.ts включает интерфейс, позволяющий использовать библиотеку Timers в Typescript.

### Обновление вашего аддона

Время от времени Valve выпускает новый API или вносит изменения в существующий API, обычно в рамках мероприятий и крупных патчей. Ваш проект Typescript не будет автоматически подстраиваться под эти изменения, поскольку их нужно сначала оформить и напечатать, что обычно делается сообществом, поддерживающим шаблон Typescript. Однако, когда будет объявлено о выходе нового обновления для Typescript for Dota 2, вы сможете легко обновить свой проект. Это можно сделать двумя способами:
* Использование терминала VSCode: Если выбранный вами редактор - VSCode и в него загружена папка вашего проекта, нажмите Terminal -> New Terminal. Откроется новый терминал. Введите `npm update` и нажмите Enter.
* Используя cmd: Откройте cmd из корневого каталога вашего проекта (`Desktop/Dota 2 custom games/typescript-example` в моем примере), затем введите `npm update` и нажмите enter.

Проект будет обновлен до новейшей версии автоматически.

### Активация наблюдателя
Для того, чтобы ваши файлы для компиляции и иметь их скомпилированные эквиваленты LUA или JavaScript, необходимо активировать наблюдателя. Наблюдатель наблюдает за всеми изменениями, сделанными на ваших файлах в проекте, и немедленно производит эквивалент LUA или JavaScript, при условии, что файл скомпилирован без ошибок. Есть три способа активировать наблюдателя:
* Использование терминала VSCode: если вы используете VSCode, и он имеет загруженную папку вашего проекта, нажмите на терминал -> Запустите задачу сборки. В качестве альтернативы вы можете использовать горячую клавишу для нее, по умолчанию `Ctrl+Shift+B`.

* Использование CMD: Откройте CMD из корневого каталога вашего проекта (`Desktop/Dota 2 custom games/typescript-example`в моем примере), Затем напечатайте `npm run dev` и нажмите Enter.

* Другие редакторы: в зависимости от редактора, редактор может иметь свой собственный метод, чтобы вызвать команду запуска по сборке запуска; Проверьте документацию редактора для получения более подробной информации.

### Нормализованные типы

При сбросе от API Dota он поставляется с некоторыми предопределенными типами. Некоторые из этих типов не очень удобны работать, поэтому вместо этого мы используем нормализованные типы. Эти нормализованные типы изменяются слегка, и их цель - увеличить читаемость вашего кода. Шаблон поставляется с нормализованными типами уже активированными.
### Интегрированные примеры

За написание этого учебника, шаблон Typescript поставляется с несколькими примерами, чтобы показать, как логика игр выполняется в Typescript. Я рекомендую держать эти файлы для справки, пока вам удобнее с помощью Typescript.

Примеры:
* В `src/vscripts/abilities/heroes/meepo/earthbind_ts_example.ts`: Пример пользовательской способности Meepo's Earthbind.
* В `src/vscripts/modifiers/modifier_panic.ts`: Пользовательский модификатор, который ограничивает команды и приказывает родителю периодически перемещаться в случайную позицию рядом с ним.
* В `src/vscripts/GameMode.ts`: Примеры логики игрового режима, например, установка максимального количества игроков для каждой команды на 3. Здесь также показаны примеры прослушивания таймеров и событий.
* В `src/panorama/hud.ts`: Пример Panorama для подписки и отправки событий.

Вы можете увидеть, как эти примеры применяются в вашем аддоне:
* Каждому герою, которого вы выберете, будет добавлена способность Meepo's Earthbind.
* В центре экрана отображается приветственная панель пользовательского интерфейса. Нажатие на кнопку закрытия в нем уберет панель и применит модификатор паники на несколько секунд.

### Выделенный канал Typescript в Moddota Discord

У нас есть специальный канал Typescript в нашем [moddota Discord](https://discord.gg/ZyHg6T9sTd) на все вопросы, связанные с Typescript. Не стесняйтесь присоединяться и спрашивать о чем угодно, и мы будем рады помочь.

### Что дальше?

Проверьте [Abilities in Typescript](typescript-ability) учебник, который покажет, как настроить и закодировать базовую способность для использования в игре.
